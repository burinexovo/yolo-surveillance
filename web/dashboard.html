<!doctype html>
<html lang="zh-Hant">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>店鋪儀表板 - TCM Shop</title>
		<link rel="stylesheet" href="/web/dashboard.css?v=20260130_0220" />
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7/dist/hls.min.js"></script>
	</head>
	<body>
		<!-- PIN 登入畫面 -->
		<div id="loginOverlay" class="login-overlay hidden">
			<div class="login-card">
				<h2>元壽蔘藥行儀表板登入</h2>
				<p class="login-subtitle">請輸入 PIN 碼</p>
				<form id="pinForm">
					<input
						type="password"
						id="pinInput"
						maxlength="10"
						placeholder="PIN 碼"
						autocomplete="off"
						inputmode="numeric"
					/>
					<button type="submit" id="pinSubmit">登入</button>
				</form>
				<p id="loginError" class="login-error hidden"></p>
			</div>
		</div>

		<header>
			<h1>元壽蔘藥行儀表板</h1>
			<div class="header-actions">
				<button id="watchBtn" class="watch-btn" title="開啟即時畫面">即時畫面</button>
				<button id="themeToggle" title="切換主題">🌙</button>
				<select id="rangeSelect">
					<option value="7d" selected>最近 7 天</option>
					<option value="14d">最近 14 天</option>
					<option value="30d">最近 30 天</option>
					<option value="90d">最近 90 天 (季度)</option>
					<option value="365d">最近 365 天 (整年)</option>
				</select>
				<button id="refreshBtn">重新整理</button>
			</div>
		</header>

		<main>
			<!-- 即時狀態卡片 -->
			<section class="cards-container">
				<div class="card" id="cardInsideCount">
					<div class="card-icon">👥</div>
					<div class="card-content">
						<div class="card-value" id="insideCount">-</div>
						<div class="card-label">目前店內人數</div>
					</div>
				</div>

				<div class="card" id="cardTodayVisits">
					<div class="card-icon">🏪</div>
					<div class="card-content">
						<div class="card-value" id="todayVisits">-</div>
						<div class="card-label">今日訪客數</div>
					</div>
				</div>

				<div class="card" id="cardLastEntry">
					<div class="card-icon">🕒</div>
					<div class="card-content">
						<div class="card-value" id="lastEntryTime">-</div>
						<div class="card-label">最後入店時間</div>
					</div>
				</div>

				<div class="card" id="cardSystemStatus">
					<div class="card-icon">📡</div>
					<div class="card-content">
						<div class="card-value" id="systemStatus">-</div>
						<div class="card-label">系統狀態</div>
					</div>
				</div>
			</section>

			<!-- 統計摘要 -->
			<section class="summary-container">
				<div class="summary-item">
					<span class="summary-label">期間總訪客</span>
					<span class="summary-value" id="totalVisits">-</span>
				</div>
				<div class="summary-item">
					<span class="summary-label">日均訪客</span>
					<span class="summary-value" id="avgDailyVisits">-</span>
				</div>
				<div class="summary-item">
					<span class="summary-label">尖峰日期</span>
					<span class="summary-value" id="peakDay">-</span>
				</div>
				<div class="summary-item">
					<span class="summary-label">尖峰時段</span>
					<span class="summary-value" id="peakHour">-</span>
				</div>
			</section>

			<!-- 圖表區域 -->
			<section class="charts-container">
				<div class="chart-card">
					<h3>今日每小時訪客分布</h3>
					<canvas id="hourlyChart"></canvas>
				</div>

				<div class="chart-card">
					<h3>每日訪客趨勢</h3>
					<canvas id="dailyChart"></canvas>
				</div>
			</section>

			<!-- 錄影回放區域 -->
			<section class="recording-section">
				<div class="recording-header">
					<h3>錄影回放</h3>
					<div class="recording-controls">
						<select id="recordingCamera" class="camera-select">
							<option value="">載入中...</option>
						</select>
						<input type="date" id="recordingDate" />
						<span class="recording-summary" id="recordingSummary">-</span>
					</div>
				</div>

				<!-- 時間線 -->
				<div class="timeline-container">
					<div class="timeline-labels">
						<span>00:00</span>
						<span>06:00</span>
						<span>12:00</span>
						<span>18:00</span>
						<span>24:00</span>
					</div>
					<div class="timeline-track" id="timelineTrack">
						<!-- 錄影片段和事件標記由 JS 動態插入 -->
					</div>
				</div>

				<!-- 影片播放器 -->
				<div class="player-container">
					<video id="videoPlayer" controls preload="metadata">
						<source src="" type="video/mp4" />
						您的瀏覽器不支援 HTML5 影片播放
					</video>
					<div class="player-info">
						<button id="prevClip" disabled>◀ 上一段</button>
						<span id="clipInfo">尚未選擇錄影</span>
						<button id="nextClip" disabled>下一段 ▶</button>
					</div>
				</div>

				<!-- 錄影片段列表 -->
				<div class="clips-list-container">
					<h4>錄影片段</h4>
					<div class="clips-list" id="clipsList">
						<!-- 片段由 JS 動態插入 -->
						<div class="no-clips">選擇日期以查看錄影</div>
					</div>
				</div>
			</section>
		</main>

		<footer>
			<p>最後更新: <span id="lastUpdate">-</span></p>
		</footer>

		<script src="/web/dashboard.js?v=20260130_0220"></script>
	</body>
</html>
